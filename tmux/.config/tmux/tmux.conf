# ~/.config/tmux/tmux.conf

# set -u/-g [-t target-session/window/pane] option
# -u: uncustomize the settings, -g: global settings

# bind [-nr] [-T key-table] key command [arguments(of the command)]
# -n: bind as non-prefix, -r: can be used repeatedly(prefix needed at first)
# -T key-table: bound to indicatedd key-table, for example copy-mode, root

# -- prefix
set -g prefix C-s
unbind C-b
bind C-s send-prefix


# -- navigation (Many key-bindings)
# Alt + s/w/p       lowercase to create, uppercase to kill
# Alt + num         to select window
# Ctrl + HJKL       to resize panes
# prefix + hjkl     to split windows(create new pane)
# Alt + direction   to select pane
# prefix + d        to detach
# prefix + s/w      to rename session/window

# session management
bind -n M-s new-session             # create new session
bind s command-prompt "rename-session '%%'"

# window management
bind -n M-w new-window -c "#{pane_current_path}"    # create new window
bind -n M-W kill-window
bind w command-prompt "rename-window '%%'"

# <Alt> + <num> to switch between windows, it's faster than C-p, C-n
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
# bind -r C-p previous-window
# bind -r C-n next-window

# pane management
# bind -n M-p kill-pane
# <prefix> + hjkl to split window, which means creating new pane
bind h split-window -hb -c "#{pane_current_path}"
bind j split-window -v  -c "#{pane_current_path}"
bind k split-window -vb -c "#{pane_current_path}"
bind l split-window -h  -c "#{pane_current_path}"

bind -n M-f resize-pane -Z  # <Alt-f> to full screen

bind -n M-h     select-pane -L
bind -n M-j     select-pane -D
bind -n M-k     select-pane -U
bind -n M-l     select-pane -R

bind -n M-Space next-layout     # Alt + Shift + space to change layout

# modify pane size
# now I cannot use them to resize the panes. Why?
bind -n C-Left  resize-pane -L 2
bind -n C-Down  resize-pane -D 2
bind -n C-Up    resize-pane -U 2
bind -n C-Right resize-pane -R 2


# -- look & feel

# True colors support
set -g default-terminal "${TERM}"
set -sg terminal-overrides ",xterm*:Tc"

# # status bar
# set -g status-style bg=default,fg=black,bright
# set -g status-left ""
# set -g status-right "#[fg=black,bright]#S"      # session name with dim color

# # window buttons
# set -g window-status-format ""


# -- general settings

set -s escape-time 0                # the delay after escape
set -sg repeat-time 1000            # the interval of repeated keys
set -s focus-events on              # update when switch the focus
set -g mouse on
set -sg exit-empty on               # quit session when close all windows

setw -q -g utf8 on                  # utf-8 support for windows

set -g visual-activity off
setw -g monitor-activity off
setw -g monitor-bell off

set -g history-limit 10000

bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded.."

# -- display

set -g base-index 1                 # 1-based indexing
set -g pane-base-index 1            # for 0 is too far to press

setw -g automatic-rename on         # windows auto rename
set -g renumber-windows on          # windows auto renumber
set -g set-titles on                # set window title

set -g display-panes-time 2000      # display information for 2s
set -g display-time 2000
set -g status-interval 1            # update statusline every 1s

# -- yazi compatible
# enable image preview
set -g allow-passthrough on
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM

# Unimportant settings

unbind p                            # unbind default previous window
unbind n
unbind 1
unbind 2
unbind 3
unbind 4
unbind 5
unbind 6
unbind 7
unbind 8
unbind 9
unbind 0

bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9
bind -n M-0 select-window -t 10

# unbind


# -- list of plugins
# Use <prefix + I> to install, <prefix + U> to update, <prefix + alt-u> to uninstall)
# It seems that tpm doesn't work sometimes.
set -g @plugin 'tmux-plugins/tpm'               # tmux plugins manager
# prefix + <C-s> to save, prefix + <C-r> to restore
# save and restore mannualy
set -g @plugin 'tmux-plugins/tmux-resurrect'    # save work status and restore
# set -g @plugin 'tmux-plugins/tmux-continuum'    # automaticly save and restore
set -g @plugin 'dracula/tmux'


########## dracula settings ##########
set -g @dracula-plugins "ram-usage battery uptime time"
set -g @dracula-show-powerline true
set -g @dracula-battery-label "♥ "
set -g @dracula-ram-usage-label "󰍛 "            # memory usage
set -g @dracula-uptime-label "󱎫 "               # show how long the system has been running
set -g @dracula-show-timezone false
set -g @dracula-time-format "%a %d/%m %R"
set -g @dracula-show-battery-status true
set -g @dracula-battery-label false

########## tmux-resurrect settings ##########
set -g @resurrect-strategy-nvim 'session'       # restoring neovim sessions

########## tmux-continuum settings ##########
# set -g @continuum-restore 'off'
# set -g @continuum-save-interval '5'             # 5 min as interval


# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run -b '~/.tmux/plugins/tpm/tpm'
